# Financial-University-course-project
## Определение физиологического возраста человека
## по параметрам, характеризующим состояние его здоровья.

Использованы данные: https://www.kaggle.com/datasets/kukuroo3/body-performance-data . 
Это данные, собранные Корейским фондом содействия развитию спорта. Они состоят из результатов различных измерений физической подготовленности, которые подтверждают степень физического состояния по возрасту и эффективности выполнения упражнений.

<b>Цель исследования:</b> построить модель (без подбора гиперпараметров), позволяющую на основании измеряемых параметров здоровья человека определять его физиологический возраст с максимально возможной точностью.

<b>Этапы исследования:</b>
1. Загрузка и изучение данных.
2. Исследовательский (разведочный) анализ и подготовка данных.
3. Подготовка данных к машинному обучению.
4. Построение моделей машинного обучения.
5. Применение фреймворков AutoML.
6. Выбор лучшей модели и выводы.

Нормой отклонения физиологического возраста от хронологического считается величина не более 5 лет. В этом случае старение рассматривается как естественное. Поэтому достаточной точностью предсказания моделью физиологического возраста на тестовых данных буду считать значение средней абсолютной ошибки менее 5 лет.

1. <b>Разведочный анализ данных</b>

Предоставленные данные состояли из 12 столбцов и 13393 строк. В выборке участвовали мужчины и женщины с разным состоянием здоровья и физического развития от 21 до 64 лет. Распределение людей в выборке по уровням состояния здоровья равномерное, мужчин 63.2%, женщин 36.8%.

Исходные данные содержали два категориальных признака: гендерный признак (gender) и экспертная оценка уровня здоровья (class). И 10 количественных признаков: возраст (age), рост (height), вес (weight), степень ожирения (body_fat), диастолическое (diastolic) и систолическое (systolic) артериальное давление, сила жима кисти (grip_forse), количество приседаний за 2 минуты (sit_ups), длина прыжка с места (broad_jump), глубина наклона вперед в положении сидя (sit_and_bend_forward). Категориальные столбцы имели тип object, количественные - float.

Пропусков в данных не было. Была обнаружена одна строка дубликат.

<b>*В результате подготовки данных было сделано:*</b>
- Названия столбцов были приведены к унифицированному виду.
- Категориальные столбцы были приведены к типу category (столбец class - с учетом порядка).
- Количественные столцы age (возраст), количество приседаний (sit_ups), длина прыжка с места (broad_jump), diastolic (нижнее артериальное давление) и systolic (верхнее артериальное давление) преобразованы к целочисленному типу int.
- Были созданы дополнительные признаки:
1. Пульсовое артериальное давление (pulse_pressure) как разность между верхним и нижним артериальными давлениями.
2. Индекс массы тела (bmi) на основании данных о росте и весе. Рост (height) и вес (weight) были удалены, как не имещие влияния на физиологический возраст.
- Признаки длина прыжка (broad_jump) и глубина наклона (sit_and_bend_forward) были нормированы к росту участника.
- Были обнаружены и исправлены ошибки в данных:
1. В ряде строк систолическое давление оказалось ниже, чем диастолическое.  Исправлено взаимной заменой значений.
2. Недостоверно низкие значения пульсового давления (ниже 10 мм рт.ст.) и диастолического давления (меньше 30 мм рт.ст.), при том, что человек может приседать и прыгать, были заменены медианными значениями.
3. Аномальные значения степени ожирения, несоответствующие индексу массы тела, также были заменены медианными значениями.
4. Аномальные значения глубины наклона (значение глубины наклона больше роста) были заменены на медианные значения.
5. Люди, отказавшиеся (имеющие нулевые значения) измерять силу жима, выполнять приседания и прыжки с места, были удалены из выборки.
6. Аномальные значения силы жима менее 5.3 кг были заменены на медианные.

Распределения значений по всем измеряемым параметрам у мужчин и у женщин, кроме экспертной оценки уровня здоровья, очень сильно различались, поэтому я принял решение рассматривать все параметры отдельно для мужчин и для женщин.
- Почти половина женщин и больше половины мужчин имеют пульсовое давление выше 50 мм рт.ст. и находятся в группе риска по сердечно-сосудистым заболеваниям.
- Медианное артериальное диастолическое (нижнее) артериальное давление у мужчин 81 мм рт.ст, у женщин - 75 мм рт.ст. В распределении диастолического давления наблюдается максимум на отметке 80 мм рт.ст. и у мужчин, и у женщин.  Это округленное измерение диастолического давления у здорового человека.
- Медианное значение систолического (верхнего) артериального давления у женщин (123 мм рт.ст.) очень близко к медицинскому стандарту 120/80 мм рт.ст. и существенно ниже, чем у мужчин (134 мм рт.ст.). А систолическое давление выше 140 - признак артериальной гипертензии. Больше четверти мужчин в выборке имеют верхнее давление выше 140 мм рт.ст. Это может свидетельствовать или о нерепрезентативности выборки (значительная часть мужчин в выборке имеют проблемы с сердечно-сосудистой системой) или о некорректности проведения измерений давления (например, после нагрузки верхнее давление может значительно повышаться, а измерение давления должно производиться в состоянии покоя).

<b>*В результате можно сказать, что:*</b>
1. *Увеличение любого давления приводит к увеличению физиологического возраста.*
2. *Физиологический возраст женщин значительно сильнее зависит от увеличения пульсового и (или) верхнего (систолического) давления чем у мужчин.*
3. *Коэффициенты корреляции возраста от всех видов давления не превышают 0.3. Это значит, что давление не является определяющим фактором для определения физиологического возраста.*

- Распределение индекса массы тела у женщин смещено в область меньших значений относительно распределения у мужчин (медианное значение BMI у мужчин равно 24.29, у женщин - 21.74). При этом величина межквартильного размаха практически совпадает. Мужчины имеют более развитую мускулатуру, а соотвественно более высокий индекс массы тела.
- В организме человека присутствует незаменимый жир. Он требуется для поддержания жизнедеятельности и репродуктивных функций. 4-6% считаются физиологическим минимумом для мужчин. Женщинам требуется для нормальной жизнедеятельности по крайней мере на 9% больше. Распределение степени ожирения у женщин смещено в область больших значений относительно распределения у мужчин (медианное значение BF у мужчин равно 20.0%, у женщин - 28.3%).
- Мужчины в основной массе приседают больше женщин. Медианное значение количества приседаний за две минуты у мужчин - 46, у женщин - 32. Количество приседаний сильно влияет на физиологический возраст как у женщин, так и у мужчин. Уменьшение количества приседаний приводит к увеличению физиологического возраста.
- Распределение длины прыжка с места у мужчин смещено относительно распределения у женщин в сторону больших значений. Оба распределения имеют скос в сторону меньших значений.
- Измерение глубины наклона вперед в положении сидя (в йоге эта поза называется пашчимоттанасана) производится относительно положения ступней. В случае, когда удается дотянуться руками дальше положения ступней - значения положительные, в противном случае - отрицательные. Распределение у женщин смещено относительно распределения у мужчин в сторону положительных значений (медианное значение у женщин равно 0.128 роста, у мужчин 0.082 роста). То есть женщины более гибкие. Подавляющее большинство людей успешно дотягиваются дальше своих ступней. Но и у мужчин, и у женщин есть люди, не сумевшие это сделать.
- Распределения значений силы жима у мужчин и у женщин симметричные. Распределение силы жима кисти мужчин смещено относительно распределения силы жима женщин в сторону больших значений более чем на 15 кг.


<b>*Влияние показателей здоровья и результатов выполнения физических упражнений на физиологический возраст.*</b>
- Физиологический возраст зависит от всех признаков в датасете (Нулевых значений корреляции у признаков с целевым признаком нет).
- При этом нет признаков очень сильно влияющих на физиологический возраст. Самая большая отрицательная корреляция у физиологического возраста с количеством приседаний -0.5354 (Значение $\phi_K$=0.53). Это значит, что с увеличением возраста приседать людям становится труднее. Это утверждение похоже на правду для среднестатистического человека.
- Следующая, также отрицательная, величина корреляции Пирсона (-0.4164) между возрастом и нормированной длиной прыжка с места. Значение $\phi_K$=0.45. То есть с возрастом становится труднее далеко прыгнуть. Это утверждение также не вызывает отрицания.
- Остальные признаки имеют слабую корреляцию с физиологическим возрастом. Можно выделить корреляцию целевого признака со степенью ожирения 0.2281 ($\phi_K$=0.28), верхним 0.2141 ($\phi_K$=0.26) и нижним 0.1648 ($\phi_K$=0.20) давлением, силой жима кистью -0.1664 ($\phi_K$=0.31).
- Самое незначительное влияние на физиологический возраст оказывает глубина наклона в положении сидя 0.04254 ($\phi_K$=0.12).

<b>*Влияние показателей друг на друга.*</b>
- Сильнее всего взаимосвязаны длина прыжка и количество приседаний - коэффициент корреляции 0.7287 ($\phi_K$=0.71).
- На втором месте пульсовое и систолическое давление - коэффициент корреляции 0.6825 ($\phi_K$=0.56).
- На третьем месте связь между систолическим и диастолическим давлениями. Коэффициент корреляции 0.6822 ($\phi_K$=0.75).
- На четвертом месте длина прыжка и сила жима - коэффициент корреляции 0.6712 ($\phi_K$=0.65).
- На пятом месте длина прыжка и степень ожирения - коэффициент корреляции -0.6390 ($\phi_K$=0.64).


Люди, имеющие возможность далеко прыгнуть, физически развиты, а значит могут много раз присесть и имеют достаточную силу кисти. А чем выше степень ожирения, тем труднее прыгать.

<b>*Сильные различия в зависимости физиологического возраста от измеряемых параметров здоровья и физического развития у женщин и мужчин вынуждают решать задачу пргнозирования физиологического возраста раздельно.*</b>

2. <b>Подготовка данных к машинному обучению.</b>

- Данные были разделены на тренировочную и тестовую выборки в соотношении 80:20.
- Сильные различия в зависимости физиологического возраста от измеряемых параметров здоровья и физического развития вынуждали решать задачу прогнозирования раздельно для мужчин и для женщин. Чтобы избежать этого, распределения признаков были нормализованы раздельно для мужчин и для женщин, а затем данные были снова объеденины. Признак gender был удален.
- Данные подготовлены к машинному обучению.

3. <b>Построение моделей.</b>

Для решения поставленной задачи были выбраны модели:
- линейная регрессия,
- стохастический градиентный спуск,
- дерево решений,
- случайный лес,
- градиентный бустинг sklearn,
- градиентный бустинг XGBoost,
- градиентный бустинг LightBoost,
- градиентный бустинг CatBoost.

Начальные установки:

- Обучение моделей производилось на подготовленных данных, поделенных неа тренировочную и тестовую выборки в соотношении 80:20.
- Подбор гиперпараметров не производился (использовались значения, установленные по умолчанию).
- В случае обнаружения признаков, в которых не было необходимости для обучения модели, этот признак исключался из рассмотрения.
- Оценка качества работы моделей производилась на тестовой выборке. Для оценки качества работы моделей использовались коэффициент детерминации $R^2$ и средняя абсолютная ошибка MAE. При оценивании качества модели кросс-валидация не использовалась.

Результаты:

- Модели линейная регрессия, стохастический градиентный спуск и градиентный бустинг sklearn показали неудовлетворительные значения метрик как на тренировочной, так и на тестовой выборках, что говорит о недообученности моделей.
- Модели дерево решений, случайный лес и градиентный бустинг XGBoost переобучились и показали на тестовой выборке значения метрик значительно хуже, чем на тренировочной. Дерево решений получилось глубиной 32 и с 8336 листьями. Такое дерево показало значение $R^2$=1.0 и среднюю абсолютную ошибку MAE=0. То есть точно предсказала результат на данных, на которых обучалась и сильно ошиблась на неизвестных данных ($R^2$=0.238 и MAE=8.619 лет).
- Модели градиентных бустингов LightGBM и CatBoost судя по всему нормально обучились и показали на тестовых данных значение метрик несколько ниже, чем на тренировочных. Лучшее значение метрик оказалось у модели LightGBM: коэффициент детерминации $R^2$=0.618 и средняя абсолютная ошибка MAE=6.423 года. Но даже эти значения далеки от идеала - ошибка в предсказании физиологического возраста 6.4 года при медианном возрасте 32 года очень велика.

<b>*Ни одна из использованных моделей без подбора гиперпараметров не смогла предсказать на предоставленных данных значение физиологического возраста с необходимой точностью. При подборе гиперпараметров моделей качество моделей может измениться в лучшую сторону.*</b>

Нормой считается отклонение физиологическогог возраста от хронологического не более чем на 5 лет. В этом случае старение рассматривается как естественное.

В случае недостаточного увеличения точности моделей после подбора гиперпараметров можно будет сделать вывод о нерепрезентативности выборки (в данных присутствует много людей с потенциальными проблемами со здоровьем, увеличивающими разрыв между физиологическим и хронологическим возрастами), а также недостаточностью признаков, влияющих на физиологический возраст, например наличие вредных привычек и семейное положение.

4. <b>Использование фреймворка автоматического машинного обучения PyCaret</b>

Для контрольной проверки результатов исследования был использован фреймворк автоматического машинного обучения PyCaret, в котором для постоения моделей использовались неподготовленные данные.

Самый лучший результат в AutoML показала модель градиентный бустинг LightGBM. На тренировочной выборке коэффициент детерминации $R^2$=0.6473, а средняя абсолютная ошибка MAE=6.1691 год. PyCaret подтвердил мой выбор модели. Но значение метрик невелико уже на тренировочной выборке (после подготовки данных к машинному обучению LightGBM на тренировочной выборке показал $R^2$=0.742 и MAE=5.241 год, возможно различие связано с тем, что PyCaret вычисляет значения метрик с использованием кросс-валидации).

Самым важным признаком для модели LightGBM из фреймворка PyCaret оказалась длина прыжка. На втором месте рост. Затем вес, количество приседаний, степень ожирения и глубина наклона вперед. Наименее важными признаками оказались гендерный признак и уровень здоровья.

На тестовой выборке выбранная модель LightGBM показала значение коэффициента детерминации $R^2$=0.6543 и среднюю абсолютную ошибку MAE=6.0797. Эти значения лучше, чем на тренировочной выборке. Скорее всего это просто случайность, которую можно объяснить удачным подбором данных в тестовой выборке.


<b>Вывод:</b>
- Модели, построенные без подбора гиперпараметров не смогли достичь заданной точности (средняя абсолютная ошибка MAE менее 5 лет).
- Лучшей среди рассмотренных моделей оказался градиентный бустинг LightGBM со значением средней абсолютной ошибки на тренировочной выборке MAE=5.241 год. На тестовой выборке эта модель показала MAE=6.423 года.
- В качестве продолжения исследования можно предложить провести подбор гиперпараметров модели с целью увеличения точности предсказания. В случае невозможности достичь требуемой точности - предложить повторно собрать данные, сделав выборку более репрезентативной и добавить в список параметров дополнительные признаки, такие как наличие вредных привычек и семейное положение.
